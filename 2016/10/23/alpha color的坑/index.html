<!DOCTYPE html>
<html>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="之前有遇到一个十分神奇的bug，不知道是什么原因突然整个项目所有引用某个颜色资源Id的地方突然就变成了透明色。而这个bug复现的时机又不是很清楚，重启应用又会恢复正常，用着用着又会出现，着实让我摸不着头脑。 原来是前不久做了一个标题栏的属性动画，动画中一个View的Alpha值会从透明到纯白或从纯白到透明，而这个纯白色#FFFFFF的资源id有很多地方都有用到，也就是引用了这个颜色资源id的地方会">
<meta property="og:type" content="article">
<meta property="og:title" content="修改View Background Color导致的坑">
<meta property="og:url" content="https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/index.html">
<meta property="og:site_name" content="Tech Cabana">
<meta property="og:description" content="之前有遇到一个十分神奇的bug，不知道是什么原因突然整个项目所有引用某个颜色资源Id的地方突然就变成了透明色。而这个bug复现的时机又不是很清楚，重启应用又会恢复正常，用着用着又会出现，着实让我摸不着头脑。 原来是前不久做了一个标题栏的属性动画，动画中一个View的Alpha值会从透明到纯白或从纯白到透明，而这个纯白色#FFFFFF的资源id有很多地方都有用到，也就是引用了这个颜色资源id的地方会">
<meta property="og:locale">
<meta property="article:published_time" content="2016-10-23T23:03:52.000Z">
<meta property="article:modified_time" content="2026-01-15T11:12:04.673Z">
<meta property="article:author" content="Kang Yang">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>修改View Background Color导致的坑</title>
    <!-- async scripts -->
    <!-- Google Analytics -->

  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-110925633-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-110925633-1');
  </script>


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 8.1.1"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a href="http://github.com/codeideal">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2016/11/15/VirtualBox%E5%AE%89%E8%A3%85Linux%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%B1%E4%BA%AB%E6%96%87%E4%BB%B6/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2016/08/15/%E5%9B%BE%E7%89%87%E5%BA%93%E5%AF%B9%E6%AF%94%E6%83%85%E5%86%B5/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&text=修改View Background Color导致的坑"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&is_video=false&description=修改View Background Color导致的坑"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=修改View Background Color导致的坑&body=Check out this article: https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&name=修改View Background Color导致的坑&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&t=修改View Background Color导致的坑"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        修改View Background Color导致的坑
    </h1>



      <div class="meta">
        <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <span class="p-name" itemprop="name">
            Kang Yang
                    
          </span>
        </span>
        
    <div class="postdate">
      
        <time datetime="2016-10-23T23:03:52.000Z" class="dt-published" itemprop="datePublished">2016-10-23</time>
        
      
    </div>


          

            

      </div>
  </header>
  

    <div class="content e-content" itemprop="articleBody">
      <p>之前有遇到一个十分神奇的bug，不知道是什么原因突然整个项目所有引用某个颜色资源Id的地方突然就变成了透明色。而这个bug复现的时机又不是很清楚，重启应用又会恢复正常，用着用着又会出现，着实让我摸不着头脑。</p>
<p>原来是前不久做了一个标题栏的属性动画，动画中一个View的Alpha值会从透明到纯白或从纯白到透明，而这个纯白色#FFFFFF的资源id有很多地方都有用到，也就是引用了这个颜色资源id的地方会突然变成透明色。</p>
<p>这个属性动画是随着页面滚动标题栏从透明过渡到白色背景色的实现，类似于 Design 库中 AppBar 的那种效果。实现方法是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 滚动监听器 伪代码</span><br><span class="line">onscroll()&#123;</span><br><span class="line">	percent = ....</span><br><span class="line">  	view.getBackground().setAlpha(percent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我意识到跟这个资源ID有关时，便Google了一下，果然这里面别有玄机。</p>
<p>StackOverflow中高赞回答提到: view.getBackground() 获得的是一个 ColorDrawable，如果给这个 ColorDrawable 设置 Alpha 值的话，会影响所有设置 background 为这个颜色资源ID的背景色的 Alpha 值。</p>
<p>再到Android文档中去看了看Drawable的相关文档，验证了之前的说法，从同一资源加载的 drawable 确实会共享状态，不过有一个 mutate 方法来禁用这一特性。文档如下：</p>
<blockquote>
<p><a href="https://developer.android.com/reference/android/graphics/drawable/Drawable.html#mutate()">Drawable</a> mutate ()</p>
<p>Make this drawable mutable. This operation cannot be reversed. A mutable drawable is guaranteed to not share its state with any other drawable. This is especially useful when you need to modify properties of drawables loaded from resources. By default, all drawables instances loaded from the same resource share a common state; if you modify the state of one instance, all the other instances will receive the same modification. Calling this method on a mutable Drawable will have no effect.</p>
<p><strong>翻译：</strong></p>
<p>Drawable mutate ()</p>
<p>让一个 Drawable 变为 mutable 的。这个操作是不可逆的。一个 mutable 的 drawable 可以保证不会分享自己的状态给其他 drawable。当一个 drawable 是从 resource 加载的，在需要更改它状态时这个方法特别有用。在默认情况下，所有从相同 resource 的 drawable 的实例是共享一个通用状态的；如果你修改了其中一个的状态，所有其他的实例也会收到相同的改动。在一个已经是可变的 drawable 上调用该方法没有效果。</p>
</blockquote>
<p>所以，上述代码只要在 drawable 获取之后，调用一下 mutate() 方法即可(如下)。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 滚动监听器 伪代码</span></span><br><span class="line">onscroll()&#123;</span><br><span class="line">	percent = ....</span><br><span class="line">  	view.getBackground().mutate().setAlpha(percent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


    </div>
</article>
<div id="donate" class="donate">
    <a id="github" href="https://github.com/codeideal" target="_blank" class="pos-f tr3" title="Github"></a>
    <div id="DonateText" class="tr3">Donate</div>
    <ul id="donateBox" class="list pos-f tr3">
        <li id="PayPal">
            <a href="https://www.paypal.me/Codeideal" target="_blank">PayPal</a>
        </li>
        <li id="Solana">
            <a href="https://moonpay.hel.io/pay/6968c9646c87f5d568aac432" target="_blank">Solana</a>
        </li>
        <li id="AliPay">AliPay</li>
        <li id="WeChat">WeChat</li>
    </ul>
    <div id="QRBox" class="pos-f left-100">
        <div id="BTCQR" class="MainBox" style="background-image: url(/images/bitcoinQR.png)"></div>
        <div id="AliPayQR" class="MainBox" style="background-image: url(/images/alipayQR.png)"></div>
        <div id="WeChatQR" class="MainBox" style="background-image: url(/images/wechatQR.png)"></div>
    </div>
</div>
  
    <div class="blog-post-comments">
        <div id="disqus_thread">
            <noscript>Please enable JavaScript to view the comments.</noscript>
        </div>
    </div>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a href="http://github.com/codeideal">Projects</a></li>
        
      </ul>
    </div>

    
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&text=修改View Background Color导致的坑"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&is_video=false&description=修改View Background Color导致的坑"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=修改View Background Color导致的坑&body=Check out this article: https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&title=修改View Background Color导致的坑"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&name=修改View Background Color导致的坑&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=https://cabana.tech/2016/10/23/alpha%20color%E7%9A%84%E5%9D%91/&t=修改View Background Color导致的坑"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2026
        Kang Yang <a href="/LoveStory"><i class="fa fa-heart"></i></a>
          <br />
          <a href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2026000344号</a>
          <img src="https://beian.mps.gov.cn/web/assets/logo01.6189a29f.png"
            style="height: 14px; vertical-align: middle;"><a
            href="https://beian.mps.gov.cn/#/query/webSearch?code=44011102484572" rel="noreferrer"
            target="_blank">粤公网安备44011102484572号</a>
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       -->
          <li><a href="/">
              Home
            </a></li><!--
     -->
          <!--
       -->
          <li><a href="/about/">
              About
            </a></li><!--
     -->
          <!--
       -->
          <li><a href="/archives/">
              Writing
            </a></li><!--
     -->
          <!--
       -->
          <li><a href="http://github.com/codeideal">
              Projects
            </a></li><!--
     -->
          
      </ul>
    </nav>
  </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

    <script type="text/javascript">
        var disqus_shortname = 'codeideal';

        (function(){
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        }());
    </script>

<!-- utterances Comments -->

</body>
</html>
